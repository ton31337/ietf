<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE rfc [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">
  <!ENTITY RFC2119 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
  <!ENTITY RFC4271 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4271.xml">
  <!ENTITY RFC7911 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7911.xml">
  <!ENTITY RFC8174 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml">
]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" category="std" docName="draft-ietf-idr-addpath-paths-limit-00" ipr="trust200902" consensus="true" obsoletes="" updates="" submissionType="IETF" xml:lang="en" tocInclude="true" tocDepth="4" symRefs="true" sortRefs="true" version="3">
  <!-- xml2rfc v2v3 conversion 3.12.8 -->
  <front>
    <title abbrev="Paths Limit for Multiple Paths in BGP">Paths Limit for Multiple Paths in BGP</title>
    <seriesInfo name="Internet-Draft" value="draft-ietf-idr-addpath-paths-limit-00"/>
    <author fullname="Donatas Abraitis" surname="Abraitis">
      <organization>NetDef</organization>
      <address>
        <email>donatas@opensourcerouting.org</email>
      </address>
    </author>
    <author fullname="Alvaro Retana" surname="Retana">
      <organization>Futurewei Technologies, Inc.</organization>
      <address>
        <email>aretana@futurewei.com</email>
      </address>
    </author>
    <author fullname="Jeffrey Haas" surname="Haas">
      <organization>Juniper Networks</organization>
      <address>
        <email>jhaas@juniper.net</email>
      </address>
    </author>
    <date year="2024"/>
    <area>Routing</area>
    <workgroup>Inter-Domain Routing</workgroup>
    <keyword>BGP ADD-PATH</keyword>
    <abstract>
      <t>
        This document specifies a BGP capability that complements the 
        ADD-PATH Capability by indicating the maximum number of paths a 
        BGP speaker can receive from a peer, optimizing the 
        transmission of BGP routes by selectively relaying pertinent 
        routes instead of the entire set.
      </t>
    </abstract>
  </front>
  <middle>
    <section>
      <name>Introduction</name>
      <t>
        BGP ADD-PATH <xref target="RFC7911"/> defines a BGP extension
        that allows the advertisement of multiple paths for the same address
        prefix without the new paths implicitly replacing any previous ones.
      </t>
      <t>
        Multiple paths for a large number of prefixes may be received by a BGP
        speaker, potentially depleting memory resources or even causing
        network-wide instability, which can be considered a denial-of-service
        attack. Without knowing the path limit the receiver is capable 
        of accepting, the sender can send as many routes as it wants.  
        <xref target="I-D.ietf-idr-add-paths-guidelines"/> provides 
        recommendations for the use of BGP ADD-PATH while implementing 
        specific applications.
      </t>
      <t>
        This document specifies a BGP capability 
        <xref target="RFC5492"/> that complements the 
        ADD-PATH Capability <xref target="RFC7911"/> by indicating the 
        maximum number of paths a BGP speaker can receive from a peer. 
        This indication allows the sender to optimize the transmission 
        of BGP routes by selectively relaying pertinent routes instead 
        of the entire set.
      </t>
    </section>
    <section anchor="simple_list">
      <name>Specification of Requirements</name>
      <t>
        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
        "OPTIONAL" in this document are to be interpreted as described in BCP
        14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when,
        they appear in all capitals, as shown here.
      </t>
    </section>
    <section>
      <name>Paths Limit capability</name>
      <t>
       The Paths Limit Capability is a BGP capability 
       <xref target="RFC5492"/>, with Capability Code TBD.  The 
       Capability Length field of this capability is variable.  The 
       Capability Value field consists of one or more of the following 
       tuples:
      </t>
      <figure anchor="paths_limit_capability">
        <artwork align="center"><![CDATA[
    +------------------------------------------------+
    | Address Family Identifier (2 octets)           |
    +------------------------------------------------+
    | Subsequent Address Family Identifier (1 octet) |
    +------------------------------------------------+
    | Paths Limit (2 octet)                          |
    +------------------------------------------------+
            ]]></artwork>
      </figure>
      <t>
        A BGP speaker who wishes to indicate support for multiple AFI/SAFIs MUST
        do so by including the information in a single instance of the
        PATHS-LIMIT capability.
      </t>
      <t>
        This new PATHS-LIMIT capability MUST be used only with ADD-PATH capability.
        If PATHS-LIMIT capability is received, but no ADD-PATH capability, then
        PATHS-LIMIT capability MUST be ignored.
      </t>
      <ul>
        <li>
          Paths Limit: this field indicates the maximum paths limit the receiver
          is able to receive from its peer. If the Paths Limit is received as zero (0),
          the capability SHOULD be ignored.
        </li>
      </ul>
      <t>
        If both ADD-PATH capability, and PATHS-LIMIT are negotiated, but PATHS-LIMIT
        capability is empty (no per AFI/SAFI limits defined), the capability SHOULD be
        ignored.
      </t>
      <t>
        Paths limit is defined as 2 octets to avoid being too small for some specific
        use cases, like huge ECMP fabrics. But a typical use case would be on the order
        of between 2 and 8.
      </t>
    </section>
    <section>
      <name>Operation</name>
      <t>
        For a BGP speaker to be able to send paths limit to its peer, that BGP speaker
        MUST advertise the PATHS-PATH Capability and specify the Paths Limit count is
        willing to receive.
      </t>
      <t>
        PATHS-LIMIT capability MUST be advertised only if ADD-PATH capability is
        supported by the sender.
      </t>
      <t>
        If the sender wants to advertise multiple paths for the same prefix, and
        PATHS-LIMIT capability is advertised, and received, then the sender MUST
        respect this paths limit and send only the specified maximum number of paths
        per prefix instead of sending all known paths or as many as the sender wants.
      </t>
      <t>
        A BGP speaker SHOULD include the best route <xref target="RFC4271"/> when more
        than one path is advertised to a neighbor unless it is a path received from
        that neighbor.
      </t>
      <t>
        Usually, some implementations provide a few options to either send all known
        paths or send N best paths.
        The receiving implementation SHOULD provide a configuration knob to specify
        the maximum number of paths to accept from the sender for multipath prefixes.
        If for example, the receiver advertises paths limit as 2, but the sender has
        6 paths to send, it MUST send only 2 best paths.
      </t>
    </section>
    <section anchor="IANA">
      <name>IANA Considerations</name>
      <t>
        IANA has assigned the value TBD for the PATHS-LIMIT Capability
        described in this document.  This registration is in the
        "Capability Codes" registry.
      </t>
    </section>
  </middle>
  <back>
    <references>
      <name>References</name>
      <references>
      <name>Normative References</name>
        <xi:include href="https://www.rfc-editor.org/refs/bibxml/reference.RFC.2119.xml"/>
        <xi:include href="https://www.rfc-editor.org/refs/bibxml/reference.RFC.4271.xml"/>
        <xi:include href="https://www.rfc-editor.org/refs/bibxml/reference.RFC.5492.xml"/>
	      <xi:include href="https://www.rfc-editor.org/refs/bibxml/reference.RFC.7911.xml"/>
        <xi:include href="https://www.rfc-editor.org/refs/bibxml/reference.RFC.8174.xml"/>
      </references>
      <references>
      <name>Informative References</name>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-idr-add-paths-guidelines.xml"/>
      </references>
    </references>
  </back>
</rfc>
